<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>peep</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&family=Source+Code+Pro:wght@400;500;700&display=swap" rel="stylesheet">

<script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
      "mindar-face-three":"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-face-three.prod.js"
    }
  }
  </script>
  <script type="module">
    import * as THREE from 'three';
    import { MindARThree } from 'mindar-face-three';

    const mindarThree = new MindARThree({
      container: document.querySelector("#container"),
    });

    const { renderer, scene, camera } = mindarThree;

    // Set the background color of the scene to white
    scene.background = new THREE.Color(0xffffff);

    const light = new THREE.HemisphereLight(0xffffff, 0xaaaaaa, 1);
    scene.add(light);

    const faceMesh = mindarThree.addFaceMesh();
    const textureUrls = [
      'https://luminafieldsnz.github.io/Lumina/face0.png',
      'https://luminafieldsnz.github.io/Lumina/faceblack.png',
      'https://luminafieldsnz.github.io/Lumina/facered.png',
      'https://luminafieldsnz.github.io/Lumina/facegreen.png'
    ];
    let currentTextureIndex = 0;

    const loadTexture = (url) => {
      const textureLoader = new THREE.TextureLoader();
      return new Promise((resolve) => {
        textureLoader.load(url, resolve);
      });
    };

    const updateTexture = async () => {
const texture = await loadTexture(textureUrls[currentTextureIndex]);
faceMesh.material.map = texture;
faceMesh.material.needsUpdate = true;

// Make the face mesh background transparent
faceMesh.material.transparent = true;
faceMesh.material.opacity = 1;  // Fully opaque texture
faceMesh.material.blending = THREE.NormalBlending;  // Ensures correct blending
};

    const changeTexture = () => {
      currentTextureIndex = (currentTextureIndex + 1) % textureUrls.length;
      updateTexture();
    };

    // Set initial texture
    updateTexture();

    scene.add(faceMesh);

    const start = async() => {
      await mindarThree.start();
      renderer.setAnimationLoop(() => {
        renderer.render(scene, camera);
      });
    }

    start();

    // Add button for changing texture
    document.getElementById('changeTextureButton').addEventListener('click', changeTexture);
  </script>

<link rel="stylesheet" href="./style.css">

<style>

#container {
        width: 100vw;
        height: 100vh;
        position: relative;
        overflow: hidden;
      }

</style>

</head>
<body>




  <div style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 99999; display: flex; gap: 10px;">
    <!-- Add this to your HTML file -->
    <button class="open-modal" style=" z-index: 9999999; color: black; border-color: black; padding: 10px 20px; border: 2px solid black; background-color: white;" id="spawnCrowdButton">Luminate</button>
    <button class="open-modal" style="color: black; border-color: black; padding: 10px 20px; border: 2px solid black; background-color: white;" id="changeTextureButton">Summon</button>
  </div>
  

<canvas id="canvas"></canvas>



<div id="container">
</div>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/gsap/3.2.6/gsap.min.js'></script>
<!-- partial -->
<script  src="./peep.js"></script>
</body>
</html>
