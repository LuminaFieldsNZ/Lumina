<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Letters</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
            overflow: hidden;
            background-color: #f0f0f0;
        }

        .letter {
            position: absolute;
            font-size: 8vw;
            cursor: pointer;
            white-space: nowrap;
            transform-origin: center;
            user-select: none;
            touch-action: none;
            transition: transform 0.2s ease;
            /* Add visual feedback for touch */
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }

        .letter:active {
            transform: scale(0.95);
        }

        .switch-container {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1;
            display: flex;
            align-items: center;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            border-radius: 50%;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
        }

        input:checked + .slider {
            background-color: #4caf50;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .label {
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .letter {
                font-size: 12vw;
            }
        }
    </style>
</head>
<body>
    <div class="switch-container">
        <label class="switch">
            <input type="checkbox" id="sound-toggle" checked>
            <span class="slider"></span>
        </label>
        <span class="label">Allow Sound</span>
    </div>

    <script>
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const audioBuffers = new Map();
        let isSoundEnabled = true;

        const soundFiles = {
            a: ['sounds/a.mp3', 'sounds/a.webm'],
            b: ['sounds/b.mp3', 'sounds/b.webm'],
            c: ['sounds/c.mp3', 'sounds/c.webm'],
            d: ['sounds/d.mp3', 'sounds/d.webm'],
            e: ['sounds/e.mp3', 'sounds/e.webm'],
            f: ['sounds/f.mp3', 'sounds/f.webm'],
            g: ['sounds/g.mp3', 'sounds/g.webm'],
            h: ['sounds/h.mp3', 'sounds/h.webm'],
            i: ['sounds/i.mp3', 'sounds/i.webm'],
            j: ['sounds/j.mp3', 'sounds/j.webm'],
            k: ['sounds/k.mp3', 'sounds/k.webm'],
            l: ['sounds/l.mp3', 'sounds/l.webm'],
            m: ['sounds/m.mp3', 'sounds/m.webm'],
            n: ['sounds/n.mp3', 'sounds/n.webm'],
            o: ['sounds/o.mp3', 'sounds/o.webm'],
            p: ['sounds/p.mp3', 'sounds/p.webm']
        };

        // Preload audio files
        async function preloadAudio() {
            for (const [letter, files] of Object.entries(soundFiles)) {
                try {
                    const response = await fetch(files[0]); // Try mp3 first
                    const arrayBuffer = await response.arrayBuffer();
                    const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                    audioBuffers.set(letter, audioBuffer);
                } catch (error) {
                    console.log(`Failed to load mp3 for ${letter}, trying webm`);
                    try {
                        const response = await fetch(files[1]); // Try webm as fallback
                        const arrayBuffer = await response.arrayBuffer();
                        const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                        audioBuffers.set(letter, audioBuffer);
                    } catch (err) {
                        console.error(`Failed to load audio for letter ${letter}:`, err);
                    }
                }
            }
        }

        // Initialize audio context on first user interaction
        function initAudio() {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        // Play sound using Web Audio API
        function playSound(letter) {
            if (!isSoundEnabled) return;
            
            initAudio();
            
            const buffer = audioBuffers.get(letter);
            if (buffer) {
                const source = audioContext.createBufferSource();
                source.buffer = buffer;
                source.connect(audioContext.destination);
                source.start(0);
            }
        }

        const soundToggle = document.getElementById('sound-toggle');
        soundToggle.addEventListener('change', (event) => {
            isSoundEnabled = event.target.checked;
        });

        function getRandomPosition(letterWidth, letterHeight) {
            const maxX = window.innerWidth - letterWidth;
            const maxY = window.innerHeight - letterHeight;
            return {
                x: Math.random() * maxX,
                y: Math.random() * maxY
            };
        }

        function getRandomRotation() {
            return Math.random() * 360;
        }

        function isOverlapping(rect1, rect2) {
            return !(rect1.right < rect2.left || 
                     rect1.left > rect2.right || 
                     rect1.bottom < rect2.top || 
                     rect1.top > rect2.bottom);
        }

        function displayLetters() {
            const body = document.body;
            const keys = Object.keys(soundFiles);
            const letterWidth = 120;
            const letterHeight = 120;
            const letters = [];

            keys.forEach(letter => {
                let position, overlaps;

                do {
                    position = getRandomPosition(letterWidth, letterHeight);
                    const newRect = {
                        left: position.x,
                        top: position.y,
                        right: position.x + letterWidth,
                        bottom: position.y + letterHeight
                    };
                    overlaps = letters.some(({ rect }) => isOverlapping(rect, newRect));
                } while (overlaps);

                const letterElement = document.createElement('div');
                letterElement.textContent = letter.toUpperCase();
                letterElement.className = 'letter';
                letterElement.style.left = `${position.x}px`;
                letterElement.style.top = `${position.y}px`;
                letterElement.style.transform = `rotate(${getRandomRotation()}deg)`;

                // Use pointerdown instead of click/touch events
                letterElement.addEventListener('pointerdown', (event) => {
                    event.preventDefault();
                    playSound(letter);
                });

                body.appendChild(letterElement);

                letters.push({
                    element: letterElement,
                    rect: {
                        left: position.x,
                        top: position.y,
                        right: position.x + letterWidth,
                        bottom: position.y + letterHeight
                    }
                });
            });
        }

        window.addEventListener('resize', () => {
            document.body.innerHTML = '';
            displayLetters();
        });

        // Start loading audio files when the page loads
        document.addEventListener('DOMContentLoaded', async () => {
            await preloadAudio();
            displayLetters();
        });

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                audioContext.suspend();
            } else {
                if (isSoundEnabled) {
                    audioContext.resume();
                }
            }
        });
    </script>
</body>
</html>