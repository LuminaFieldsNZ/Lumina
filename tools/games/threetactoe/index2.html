<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3-Person Tic Tac Toe</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px;
            padding: 0;
            background-color: #f0f0f0;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 5px;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1; /* Make the board square */
        }

        .cell {
            width: 100%;
            height: 100%;
            border: 1px solid #000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            touch-action: none;
            box-sizing: border-box;
        }

        .draggable {
            width: 80px;
            height: 80px;
            border: 1px solid #000;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px;
            cursor: grab;
            position: relative;
            touch-action: none;
            background-color: #fff;
        }

        .active {
            background-color: lightgreen;
        }

        #drag-area {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            margin-top: 20px;
        }

        .container {
            position: relative;
        }

        /* Make sure the board adjusts for mobile screens */
        @media (max-width: 600px) {
            #board {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(4, 1fr);
                max-width: 100%;
            }

            .cell {
                font-size: 18px;
            }

            .draggable {
                width: 60px;
                height: 60px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>

<h1>3-Person Tic Tac Toe</h1>
<div id="board"></div>
<div id="drag-area">
    <div class="container">
        <div class="draggable" id="X" draggable="true">X</div>
    </div>
    <div class="container">
        <div class="draggable" id="O" draggable="true">O</div>
    </div>
    <div class="container">
        <div class="draggable" id="N" draggable="true">N</div>
    </div>
</div>
<div id="message"></div>

<script>
    const board = document.getElementById('board');
    const message = document.getElementById('message');
    let currentPlayer = 'X';
    const grid = Array(4).fill(null).map(() => Array(4).fill(null));
    let availablePieces = { 'X': 0, 'O': 0, 'N': 0 };
    const maxHold = 2;

    // Create the board
    for (let i = 0; i < 16; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.index = i;
        cell.addEventListener('dragover', (e) => e.preventDefault());
        cell.addEventListener('drop', (e) => drop(e, cell));
        cell.addEventListener('touchstart', (e) => handleTouchStart(e, cell)); // Mobile touch start
        board.appendChild(cell);
    }

    // Enable pieces every 2 seconds
    setInterval(() => {
        if (availablePieces['X'] < maxHold) availablePieces['X']++;
        if (availablePieces['O'] < maxHold) availablePieces['O']++;
        if (availablePieces['N'] < maxHold) availablePieces['N']++;
        updateDraggableStates();
    }, 2000);

    function updateDraggableStates() {
        document.querySelectorAll('.draggable').forEach(item => {
            const id = item.id;
            item.textContent = id + ' '.repeat(maxHold - availablePieces[id]);
            item.classList.toggle('active', availablePieces[id] > 0);
        });
    }

    document.querySelectorAll('.draggable').forEach(item => {
        item.addEventListener('dragstart', (e) => {
            if (!item.classList.contains('active')) {
                e.preventDefault();
            } else {
                e.dataTransfer.setData('text/plain', item.id);
                item.classList.remove('active');
            }
        });
    });

    function drop(e, cell) {
        const id = e.dataTransfer.getData('text/plain') || e.target.textContent.trim();
        const index = cell.dataset.index;
        const row = Math.floor(index / 4);
        const col = index % 4;

        if (!grid[row][col] && availablePieces[id] > 0) {
            grid[row][col] = id;
            cell.textContent = id;
            availablePieces[id]--;
            updateDraggableStates();
            if (checkWin(id)) {
                message.textContent = `${id} wins!`;
                resetGame();
            } else {
                currentPlayer = currentPlayer === 'X' ? 'O' : currentPlayer === 'O' ? 'N' : 'X';
            }
        }
    }

    function checkWin(player) {
        for (let i = 0; i < 4; i++) {
            for (let j = 0; j < 2; j++) {
                if (grid[i][j] === player && grid[i][j + 1] === player && grid[i][j + 2] === player) return true;
                if (grid[j][i] === player && grid[j + 1][i] === player && grid[j + 2][i] === player) return true;
            }
        }
        for (let i = 0; i < 2; i++) {
            for (let j = 0; j < 2; j++) {
                if (grid[i][j] === player && grid[i + 1][j + 1] === player && grid[i + 2][j + 2] === player) return true;
                if (grid[i][j + 2] === player && grid[i + 1][j + 1] === player && grid[i + 2][j] === player) return true;
            }
        }
        return false;
    }

    function resetGame() {
        setTimeout(() => {
            grid.forEach(row => row.fill(null));
            document.querySelectorAll('.cell').forEach(cell => cell.textContent = '');
            message.textContent = '';
            currentPlayer = 'X';
            availablePieces = { 'X': 0, 'O': 0, 'N': 0 };
            updateDraggableStates();
        }, 2000);
    }

    // For touch start event (support for touch devices)
    function handleTouchStart(e, cell) {
        e.preventDefault();
        const touch = e.touches[0];
        const draggedItem = e.target;
        const id = draggedItem.id;

        if (!availablePieces[id] > 0) return; // Only if piece is active

        // Position the piece exactly at touch start
        draggedItem.style.position = 'absolute';
        draggedItem.style.left = `${touch.pageX}px`;
        draggedItem.style.top = `${touch.pageY}px`;

        draggedItem.classList.add('active');

        // Move the piece as user touches and drags
        const movePiece = (moveEvent) => {
            moveEvent.preventDefault();
            const newTouch = moveEvent.touches[0];
            draggedItem.style.left = `${newTouch.pageX}px`;
            draggedItem.style.top = `${newTouch.pageY}px`;
        };

        // When touch ends, drop the piece
        const dropPiece = (dropEvent) => {
            dropEvent.preventDefault();
            const targetCell = document.elementFromPoint(dropEvent.touches[0].clientX, dropEvent.touches[0].clientY);
            if (targetCell && targetCell.classList.contains('cell')) {
                drop(dropEvent, targetCell);
            }
            draggedItem.classList.remove('active');
            document.removeEventListener('touchmove', movePiece);
            document.removeEventListener('touchend', dropPiece);
        };

        document.addEventListener('touchmove', movePiece);
        document.addEventListener('touchend', dropPiece);
    }
</script>

</body>
</html>
