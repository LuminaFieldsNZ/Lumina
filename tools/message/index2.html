<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GitHub Hash Group Search</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #postContainer { margin-top: 20px; }
        .postBox { border: 1px solid #ddd; margin-bottom: 10px; padding: 10px; }
    </style>
</head>
<body>
    <input type="file" id="jsonUpload" accept=".json">
    <input type="text" id="decryptionKey" placeholder="Enter decryption key">
    <button onclick="decryptMessages()">Decrypt Messages</button>

    <!-- Display Posts -->
    <div id="postContainer"></div>

    <script>
    let token;
    let uploadedConfig = null;

    document.getElementById('jsonUpload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    uploadedConfig = JSON.parse(event.target.result);
                    token = getDecryptedToken();
                    searchAllHashGroups();
                } catch (error) {
                    alert('Error parsing JSON file');
                }
            };
            reader.readAsText(file);
        }
    });

    function getDecryptedToken() {
        const encrypted = 'AAEEN0QsIy05WUcrJhEbCUc4LFE9Xx02L1pAJ00kUzERCUc3NwtEWA==';
        const key = 'github';
        
        const decrypted = atob(encrypted)
            .split('')
            .map((char, index) => 
                String.fromCharCode(char.charCodeAt(0) ^ key.charCodeAt(index % key.length))
            )
            .join('');
        return decrypted;
    }

    async function searchAllHashGroups() {
        if (!uploadedConfig || !uploadedConfig.hashGroups) {
            alert('Please upload a valid configuration file');
            return;
        }

        const container = document.getElementById('postContainer');
        container.innerHTML = ''; // Clear previous posts

        for (const group of uploadedConfig.hashGroups) {
            try {
                const url = `https://api.github.com/search/issues?q=${group.hash}+type:issue+in:title`;
                const response = await fetch(url, {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                });

                const data = await response.json();
                displayPosts(data.items, group.key);
            } catch (error) {
                console.error(`Error fetching GitHub posts for ${group.hash}:`, error);
            }
        }
    }

    function displayPosts(posts, groupKey) {
        const container = document.getElementById('postContainer');

        if (!posts || posts.length === 0) {
            const noPostsElement = document.createElement('div');
            noPostsElement.textContent = `No posts found for group key: ${groupKey}`;
            container.appendChild(noPostsElement);
            return;
        }

        posts.forEach((post) => {
            const postElement = document.createElement('div');
            postElement.classList.add('postBox');
            postElement.innerHTML = `
                <h3><a href="${post.html_url}" target="_blank">${post.title}</a></h3>
                <p><strong>Group Key:</strong> ${groupKey}</p>
                <p><strong>Platform:</strong> GitHub Issue</p>
                <p><strong>Encrypted Content:</strong> ${post.body}</p>
            `;
            container.appendChild(postElement);
        });
    }

    function decryptMessages() {
        const key = document.getElementById('decryptionKey').value;
        const encryptedElements = document.querySelectorAll('.postBox strong:contains("Encrypted Content:")');

        if (!key || encryptedElements.length === 0) {
            alert('Please provide a valid decryption key and have encrypted messages');
            return;
        }

        encryptedElements.forEach(element => {
            const encryptedMessage = element.nextSibling.textContent.trim();
            try {
                const decryptedMessage = aesDecrypt(encryptedMessage, key);
                element.closest('.postBox').innerHTML += 
                    `<p><strong>Decrypted Message:</strong> ${decryptedMessage}</p>`;
            } catch (error) {
                console.error('Decryption error:', error);
            }
        });
    }

    function aesDecrypt(encryptedMessage, key) {
        const decrypted = CryptoJS.AES.decrypt(encryptedMessage, key);
        return decrypted.toString(CryptoJS.enc.Utf8);
    }
    </script>
</body>
</html>